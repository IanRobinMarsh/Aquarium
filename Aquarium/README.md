# Aquarium

A WebAssembly-powered, browser-based network traffic visualiser. Live network flows are captured and rendered as an animated deep-sea aquarium — each protocol is a distinct species of fish, swimming through a richly detailed ocean scene.

![screenshot](web/assets/screenshot.png)

## What you see

### Protocol fish
| Protocol | Fish |
|---|---|
| HTTP/HTTPS | Colourful tropical reef fish |
| DNS | Silver sardines (dart in schools) |
| SSH | Sleek dark barracuda |
| TLS/QUIC | Elegant angelfish |
| UDP | Glowing jellyfish |
| Other | Shadowy background fish |

Flow volume → fish size · flow rate → fish speed

### Ambient life
- **Sea turtle** — crosses the scene periodically
- **Manta ray** — glides through every 20–60 s
- **Shark** — patrols every 35–90 s
- **Whale shark** — vast faint silhouette in the deep, every 70–170 s
- **Ambient fish school** — 28 silhouette fish drifting in loose formation

### Sea floor
Coral (branch, fan, brain, tube), kelp, sea grass, anemones, rocks, starfish, sea urchins, clams (opening to reveal a pearl), crabs (scuttling), and seahorses anchored near grass blades.

### Atmosphere
Volumetric light shafts, caustic shimmer, marine snow, bioluminescent particles in the deep, and a depth-haze gradient.

## Architecture

```
Aquarium/
├── wasm/       # Rust → WASM: packet parsing, flow state, fish lifecycle
├── capture/    # Rust native daemon: libpcap → JSON over WebSocket
└── web/
    ├── index.html
    ├── aquarium.js   # renderer: canvas animation, all drawing code
    └── pkg/          # generated by wasm-pack (git-ignored)
```

The capture daemon streams flow events over WebSocket (`ws://127.0.0.1:9001`). The browser passes them to the WASM module, which manages fish state. The JS renderer draws everything at 60 fps independently of whether new packets are arriving.

## Requirements

- [Rust](https://rustup.rs/) + `wasm-pack` (`cargo install wasm-pack`)
- `libpcap` (macOS: built-in; Linux: `apt install libpcap-dev`)
- Python 3 (for the dev server)

## Quick start

```bash
# Build WASM module and capture daemon
make

# In one terminal — serve the frontend
make serve          # http://localhost:8080

# In another terminal — start live capture (requires root for pcap)
sudo ./capture/target/release/aquarium-capture
```

Then open [http://localhost:8080](http://localhost:8080). Without the daemon running the page operates in **demo mode** with seeded traffic.

## Build targets

```bash
make wasm           # compile wasm/ → web/pkg/
make capture        # compile capture/ → capture/target/release/
make serve          # python3 -m http.server 8080
make run            # build + serve + launch daemon (sudo)
make clean          # remove all build artefacts
```

## Notes

- The capture daemon needs `sudo` (macOS) or `CAP_NET_RAW` (Linux) for raw packet access.
- The WASM module loads as a plain ES module — no bundler required.
- The renderer is intentionally decoupled from data ingestion: the aquarium stays animated even when the network is quiet.
